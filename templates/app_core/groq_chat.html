{% extends "base.html" %}
{% block title %}Groq Chat | defiv2{% endblock %}

{% block content %}
<div class="container py-5">
  <h1 class="text-center text-primary fw-bold">💬 Chat with Groq</h1>
  <p class="text-muted text-center">Talk to LLaMA-3 (Groq API) in real time.</p>

  <!-- Chat Box -->
  <div id="chat-box" class="border rounded p-3 bg-light shadow-sm mb-3"
       style="height: 400px; overflow-y: auto;">
    <div class="text-muted">🟢 Session started. Say hello 👋</div>
  </div>

  <!-- Input -->
  <form onsubmit="sendMessage(); return false;" class="d-flex">
    <input id="chat-input"
           class="form-control me-2"
           placeholder="Type a message..."
           autocomplete="off">
    <button class="btn btn-primary">Send</button>
  </form>
</div>
{% endblock %}

{% block extra_js %}
<script>
async function sendMessage(){
  const input = document.getElementById("chat-input");
  const msg = input.value.trim();
  if(!msg) return;

  appendMessage("🧑 You", msg);
  input.value = "";

  try {
    const res = await fetch("/api/groq/chat/", {   // <-- FIXED ENDPOINT
      method: "POST",
      headers: {"Content-Type":"application/json"},
      body: JSON.stringify({message: msg})
    });

    const data = await res.json();
    if(data.ok){
      appendMessage("🤖 Groq", data.answer);
    } else {
      appendMessage("⚠️ System", data.error || "Error");
    }
  } catch(err) {
    appendMessage("⚠️ System", "Request failed: " + err.message);
  }
}

function appendMessage(sender, text){
  const box = document.getElementById("chat-box");
  const div = document.createElement("div");
  div.classList.add("mb-2");
  div.innerHTML = `<strong>${sender}:</strong> ${text}`;
  box.appendChild(div);
  box.scrollTop = box.scrollHeight;
}
</script>
{% endblock %}
