{% extends "base.html" %}
{% block title %}QuickNode Simulate{% endblock %}

{% block content %}
<div class="container py-5"
     x-data="simulateApp()"
     x-init="init()">

  <!-- Title -->
  <h1 class="mb-4 text-warning fw-bold">⚡ QuickNode Simulation</h1>
  <p class="text-muted">Enter call parameters and run a live simulation via QuickNode RPC.</p>

  <!-- Simulation Form -->
  <form @submit.prevent="simulate" class="card shadow-sm p-4 mb-4">
    <div class="mb-3">
      <label class="form-label">Contract Address (to)</label>
      <input type="text" x-model="to" class="form-control" placeholder="0x123...">
    </div>
    <div class="mb-3">
      <label class="form-label">Calldata</label>
      <input type="text" x-model="data" class="form-control" placeholder="0x...">
    </div>
    <button class="btn btn-warning w-100" type="submit" :disabled="loading">
      <span x-show="!loading">▶️ Simulate</span>
      <span x-show="loading">⏳ Running...</span>
    </button>
  </form>

  <!-- Output -->
  <div class="card shadow-sm">
    <div class="card-header fw-bold">Simulation Output</div>
    <pre class="p-3 bg-light m-0" style="max-height: 400px; overflow:auto;"
         x-text="output || 'Results will appear here...'">
    </pre>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function simulateApp() {
  return {
    to: "",
    data: "",
    output: "",
    loading: false,

    init() {
      console.log("QuickNode Simulator initialized");
    },

    async simulate() {
      this.loading = true;
      this.output = "";
      try {
        const res = await fetch("/api/simulate/", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ to: this.to, data: this.data })
        });
        const result = await res.json();
        this.output = JSON.stringify(result, null, 2);
      } catch (err) {
        this.output = "❌ Error: " + err.message;
      } finally {
        this.loading = false;
      }
    }
  }
}
</script>
{% endblock %}
