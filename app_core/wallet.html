{% extends "base.html" %}
{% block title %}Wallet Demo{% endblock %}
{% block content %}
<div class="container text-center mt-5">
  <h2>Wallet Demo</h2>
  <p class="lead">Connect your wallet to Base Sepolia via QuickNode</p>

  <button id="connectBtn" class="btn btn-primary">Connect Wallet</button>
  <div id="walletAddress" class="mt-3"></div>
</div>
{% endblock %}

{% block extra_js %}
<script>
const connectBtn = document.getElementById("connectBtn");
const walletAddressDiv = document.getElementById("walletAddress");
const RPC_URL = "{{ rpc_url }}";
const CHAIN_ID = 84532; // Base Sepolia testnet

async function connectWallet() {
  if (typeof window.ethereum === "undefined") {
    alert("Please install MetaMask or Coinbase Wallet extension.");
    return;
  }

  try {
    const accounts = await window.ethereum.request({ method: "eth_requestAccounts" });
    const account = accounts[0];
    walletAddressDiv.innerHTML = `<strong>Connected:</strong> ${account}`;

    // Ensure Base Sepolia network is added
    await window.ethereum.request({
      method: "wallet_addEthereumChain",
      params: [{
        chainId: "0x" + CHAIN_ID.toString(16),
        chainName: "Base Sepolia",
        nativeCurrency: { name: "ETH", symbol: "ETH", decimals: 18 },
        rpcUrls: [RPC_URL],
        blockExplorerUrls: ["https://sepolia.basescan.org"]
      }]
    });
  } catch (err) {
    console.error(err);
    alert("Error connecting wallet: " + err.message);
  }
}

connectBtn.addEventListener("click", connectWallet);
</script>
{% endblock %}
